<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.0.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.0" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="分类">
<meta property="og:url" content="http://yoursite.com/categories/index.html">
<meta property="og:site_name" content="Just a blog">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-05-28T06:22:34.105Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="分类">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/categories/">





  <title>Just a blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Just a blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/15/838-Push-Dominoes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/15/838-Push-Dominoes/" itemprop="url">838. Push Dominoes</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-15T00:42:00+08:00">2020-02-15</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-15T00:54:31+08:00">2020-02-15</time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="838-push-dominoes"><a class="header-anchor" href="#838-push-dominoes">¶</a><a href="https://leetcode.com/problems/push-dominoes/" target="_blank" rel="noopener">838. Push Dominoes</a></h3>
<p>Difficulty: <strong>Medium</strong></p>
<p>There are<font face="monospace" style="display: inline;"> <code>N</code></font> dominoes in a line, and we place each domino vertically upright.</p>
<p>In the beginning, we simultaneously push some of the dominoes either to the left or to the right.</p>
<p><img src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/05/18/domino.png" alt></p>
<p>After each second, each domino that is falling to the left pushes the adjacent domino on the left.</p>
<p>Similarly, the dominoes falling to the right push their adjacent dominoes standing on the right.</p>
<p>When a vertical domino has dominoes falling on it from both sides, it stays still due to the balance of the forces.</p>
<p>For the purposes of this question, we will consider that a falling domino expends no additional force to a falling or already fallen domino.</p>
<p>Given a string “S” representing the initial state. <code>S[i] = 'L'</code>, if the i-th domino has been pushed to the left; <code>S[i] = 'R'</code>, if the i-th domino has been pushed to the right; <code>S[i] = '.'</code>, if the <code>i</code>-th domino has not been pushed.</p>
<p>Return a string representing the final state.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;.L.R...LR..L..&quot;</span><br><span class="line">Output: &quot;LL.RR.LLRRLL..&quot;</span><br></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;RR.L&quot;</span><br><span class="line">Output: &quot;RR.L&quot;</span><br><span class="line">Explanation: The first domino expends no additional force on the second domino.</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong></p>
<ol>
<li><code>0 &lt;= N &lt;= 10^5</code></li>
<li>String <code>dominoes</code> contains only <code>'L</code>', <code>'R'</code> and <code>'.'</code></li>
</ol>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<h6 id="法一-相邻处理"><a class="header-anchor" href="#法一-相邻处理">¶</a>法一 相邻处理</h6>
<p>O(n)空间复杂度</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">pushDominoes</span><span class="params">(<span class="built_in">string</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">char</span>&gt;&gt; p;</span><br><span class="line">        p.push_back(&#123;<span class="number">-1</span>, <span class="string">'L'</span>&#125;);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; d.size(); ++i) <span class="keyword">if</span>(d[i] != <span class="string">'.'</span>) p.push_back(&#123;i, d[i]&#125;);</span><br><span class="line">        p.push_back(&#123;d.size(), <span class="string">'R'</span>&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; p.size()<span class="number">-1</span>;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p[i].second == <span class="string">'L'</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = p[i].first; j &gt; p[i<span class="number">-1</span>].first; --j) d[j] = <span class="string">'L'</span>;</span><br><span class="line">                ++i;</span><br><span class="line">            &#125;    </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(p[i].second == <span class="string">'R'</span> &amp;&amp; p[i+<span class="number">1</span>].second ==<span class="string">'L'</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = p[i].first, k = p[i+<span class="number">1</span>].first; k &gt;j ;--k, ++j) d[j] = <span class="string">'R'</span>, d[k] = <span class="string">'L'</span>;</span><br><span class="line">                i+=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(p[i].second == <span class="string">'R'</span> &amp;&amp; p[i+<span class="number">1</span>].second ==<span class="string">'R'</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = p[i].first, k = p[i+<span class="number">1</span>].first; k &gt;j ;++j) d[j] = <span class="string">'R'</span>;</span><br><span class="line">                ++i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="法二"><a class="header-anchor" href="#法二">¶</a>法二</h6>
<p>O(1)空间复杂度</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">pushDominoes</span><span class="params">(<span class="built_in">string</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;d.size();i++)</span><br><span class="line">            <span class="keyword">if</span>(d[i]==<span class="string">'R'</span>)<span class="comment">//如果是向右推的，找第一个匹配</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(j=i+<span class="number">1</span>;j&lt;d.size()&amp;&amp;d[j]==<span class="string">'.'</span>;j++);</span><br><span class="line">                <span class="keyword">if</span>(j&lt;d.size()&amp;&amp;d[j]==<span class="string">'L'</span>)<span class="comment">//如果匹配的是左，两边向中间倒</span></span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>;k&lt;=(j-i<span class="number">-1</span>)/<span class="number">2</span>;k++)</span><br><span class="line">                        d[i+k]=<span class="string">'R'</span>,d[j-k]=<span class="string">'L'</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="comment">//如果匹配的是右或者结尾，向右倒</span></span><br><span class="line">                    <span class="keyword">while</span>(--j&gt;i)</span><br><span class="line">                        d[j]=<span class="string">'R'</span>;</span><br><span class="line">                i=j;<span class="comment">//跳过已处理的部分</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(d[i]==<span class="string">'L'</span>)<span class="comment">//失配，直接向左倒</span></span><br><span class="line">                <span class="keyword">for</span>(j=i<span class="number">-1</span>;j&gt;=<span class="number">0</span>&amp;&amp;d[j]==<span class="string">'.'</span>;j--)</span><br><span class="line">                    d[j]=<span class="string">'L'</span>;</span><br><span class="line">        <span class="keyword">return</span> d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="法三-受力分析"><a class="header-anchor" href="#法三-受力分析">¶</a>法三 受力分析</h6>
<p>  力的大小取决于离最近的L或R的距离，距离越大，力道越大（多米诺的能量传递）。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">pushDominoes</span><span class="params">(<span class="built_in">string</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> f[d.size()]&#123;&#125;, f1 = <span class="number">0</span>, f2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>, j = d.size() - <span class="number">1</span>; i &lt; d.size(); ++i, --j)&#123;</span><br><span class="line">            <span class="comment">//左到右的力</span></span><br><span class="line">            <span class="keyword">if</span>(d[i] == <span class="string">'R'</span>) f1 = d.size();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(d[i] == <span class="string">'L'</span>) f1 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> f1 = max(f1 - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            f[i] += f1;</span><br><span class="line">            <span class="comment">//右到左的力</span></span><br><span class="line">            <span class="keyword">if</span>(d[j] == <span class="string">'L'</span>) f2 = d.size();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(d[j] == <span class="string">'R'</span>) f2 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> f2 = max(f2 - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            f[j] -= f2;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; d.size(); ++i) d[i] = f[i] &lt; <span class="number">0</span>? <span class="string">'L'</span>: f[i] &gt; <span class="number">0</span>?<span class="string">'R'</span>: <span class="string">'.'</span>;</span><br><span class="line">        <span class="keyword">return</span> d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/14/837-New-21-Game/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/14/837-New-21-Game/" itemprop="url">837. New 21 Game</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-14T22:34:00+08:00">2020-02-14</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-14T23:17:45+08:00">2020-02-14</time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="837-new-21-game"><a class="header-anchor" href="#837-new-21-game">¶</a><a href="https://leetcode.com/problems/new-21-game/" target="_blank" rel="noopener">837. New 21 Game</a></h3>
<p>Difficulty: <strong>Medium</strong></p>
<p>Alice plays the following game, loosely based on the card game “21”.</p>
<p>Alice starts with <code>0</code> points, and draws numbers while she has less than <code>K</code> points.  During each draw, she gains an integer number of points randomly from the range <code>[1, W]</code>, where <code>W</code> is an integer.  Each draw is independent and the outcomes have equal probabilities.</p>
<p>Alice stops drawing numbers when she gets <code>K</code> or more points.  What is the probability that she has <code>N</code> or less points?</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: N = 10, K = 1, W = 10</span><br><span class="line">Output: 1.00000</span><br><span class="line">Explanation:  Alice gets a single card, then stops.</span><br></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: N = 6, K = 1, W = 10</span><br><span class="line">Output: 0.60000</span><br><span class="line">Explanation:  Alice gets a single card, then stops.</span><br><span class="line">In 6 out of W = 10 possibilities, she is at or below N = 6 points.</span><br></pre></td></tr></table></figure>
<p><strong>Example 3:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: N = 21, K = 17, W = 10</span><br><span class="line">Output: 0.73278</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong></p>
<ol>
<li><code>0 &lt;= K &lt;= N &lt;= 10000</code></li>
<li><code>1 &lt;= W &lt;= 10000</code></li>
<li>Answers will be accepted as correct if they are within <code>10^-5</code> of the correct answer.</li>
<li>The judging time limit has been reduced for this question.</li>
</ol>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<h6 id="法一"><a class="header-anchor" href="#法一">¶</a>法一</h6>
<p>  看着像二维dp，其实是一维dp，因为每次产生一个数i的时候，子问题是<code>(N-i,K-i,W)</code>，意味着<code>N-i-(K-i)=N-K</code>，差值始终不变，所以只要用一个K就可以表示子问题了。</p>
<p>  递推式分三种情况:</p>
<ol>
<li><code>W &lt;= i时，dp[i]=dp[i-1]+dp[i-2]+...+dp[i-W]</code></li>
<li><code>W &gt; i且 W &lt;= i+N-K时，dp[i]=dp[i-1]+dp[i-2]+...+dp[0]+(W-i)</code></li>
<li><code>W &gt; i+N-K时，dp[i]=dp[i-1]+dp[i-2]+...+dp[0]+(N-K)</code></li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">new21Game</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> K, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; dp(K+<span class="number">1</span>);</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">if</span>(W == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">if</span>(K == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K; ++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(W &lt;= i) dp[i] = (dp[i<span class="number">-1</span>] - (i-W<span class="number">-1</span>&lt;<span class="number">0</span>?<span class="number">0</span>:dp[i-W<span class="number">-1</span>]))/(<span class="keyword">double</span>)W;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(W &gt; i &amp;&amp; i + N - K &gt;= W) dp[i] = (dp[i<span class="number">-1</span>]+<span class="number">1.0</span>*(W-i))/(<span class="keyword">double</span>)W;</span><br><span class="line">            <span class="keyword">else</span> dp[i] = (dp[i<span class="number">-1</span>]+<span class="number">1.0</span>*(N-K))/(<span class="keyword">double</span>)W;</span><br><span class="line">            dp[i]=dp[i<span class="number">-1</span>]+dp[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[K]-dp[K<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//dp[K]:</span></span><br><span class="line"><span class="comment">//1. dp[K-1] +...+ dp[K-W] , W &lt;= K</span></span><br><span class="line"><span class="comment">//2. dp[K-1] +...+ dp[0] + W-K, W &gt; K &amp;&amp; W &lt;= N</span></span><br><span class="line"><span class="comment">//3. dp[K-1] +...+ dp[0] + N-K, W &gt; N</span></span><br></pre></td></tr></table></figure>
<h6 id="法二"><a class="header-anchor" href="#法二">¶</a>法二</h6>
<p><a href="https://leetcode.com/articles/new-21-game/" target="_blank" rel="noopener">官方解法</a></p>
<p>  <code>dp[x]</code>代表当前有x分时胜利（得分不少于K且不大于N）的概率。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">new21Game</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> K, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span>[] dp = <span class="keyword">new</span> <span class="keyword">double</span>[N + W + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// dp[x] = the answer when Alice has x points</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = K; k &lt;= N; ++k)</span><br><span class="line">            dp[k] = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span> S = Math.min(N - K + <span class="number">1</span>, W);</span><br><span class="line">        <span class="comment">// S = dp[k+1] + dp[k+2] + ... + dp[k+W]</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = K - <span class="number">1</span>; k &gt;= <span class="number">0</span>; --k) &#123;</span><br><span class="line">            dp[k] = S / W;</span><br><span class="line">            S += dp[k] - dp[k + W];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="法三"><a class="header-anchor" href="#法三">¶</a>法三</h6>
<p>  <code>dp[i]</code>代表手中有i分的概率，<code>dp[i] = (dp[i-1]+dp[i-2]+...+dp[i-W]</code>(<code>i-W</code>要有意义才行，<code>i-1</code>也必须对应着游戏还没结束时的值即小于K)。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">new21Game</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> K, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; f(N+<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i - <span class="number">1</span> &lt; K)<span class="comment">//因为当i-1&gt;=K时，游戏已经结束，所以不能从该状态继续转移了</span></span><br><span class="line">                sum += f[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">if</span> (i - W - <span class="number">1</span>&gt;=<span class="number">0</span>)</span><br><span class="line">                sum -= f[i-W<span class="number">-1</span>];</span><br><span class="line">                </span><br><span class="line">            f[i] = sum/W;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">double</span> ans = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = K; i &lt;= N; i++) &#123;</span><br><span class="line">            ans += f[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/14/1129-Shortest-Path-with-Alternating-Colors/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/14/1129-Shortest-Path-with-Alternating-Colors/" itemprop="url">1129. Shortest Path with Alternating Colors</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-14T18:25:00+08:00">2020-02-14</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-14T20:33:53+08:00">2020-02-14</time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1129-shortest-path-with-alternating-colors"><a class="header-anchor" href="#1129-shortest-path-with-alternating-colors">¶</a><a href="https://leetcode.com/problems/shortest-path-with-alternating-colors/" target="_blank" rel="noopener">1129. Shortest Path with Alternating Colors</a></h3>
<p>Difficulty: <strong>Medium</strong></p>
<p>Consider a directed graph, with nodes labelled <code>0, 1, ..., n-1</code>.  In this graph, each edge is either red or blue, and there could be self-edges or parallel edges.</p>
<p>Each <code>[i, j]</code> in <code>red_edges</code> denotes a red directed edge from node <code>i</code> to node <code>j</code>.  Similarly, each <code>[i, j]</code> in <code>blue_edges</code> denotes a blue directed edge from node <code>i</code> to node <code>j</code>.</p>
<p>Return an array <code>answer</code> of length <code>n</code>, where each <code>answer[X]</code> is the length of the shortest path from node <code>0</code> to node <code>X</code> such that the edge colors alternate along the path (or <code>-1</code> if such a path doesn’t exist).</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 3, red_edges = [[0,1],[1,2]], blue_edges = []</span><br><span class="line">Output: [0,1,-1]</span><br></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 3, red_edges = [[0,1]], blue_edges = [[2,1]]</span><br><span class="line">Output: [0,1,-1]</span><br></pre></td></tr></table></figure>
<p><strong>Example 3:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 3, red_edges = [[1,0]], blue_edges = [[2,1]]</span><br><span class="line">Output: [0,-1,-1]</span><br></pre></td></tr></table></figure>
<p><strong>Example 4:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 3, red_edges = [[0,1]], blue_edges = [[1,2]]</span><br><span class="line">Output: [0,1,2]</span><br></pre></td></tr></table></figure>
<p><strong>Example 5:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 3, red_edges = [[0,1],[0,2]], blue_edges = [[1,0]]</span><br><span class="line">Output: [0,1,1]</span><br></pre></td></tr></table></figure>
<p><strong>Constraints:</strong></p>
<ul>
<li><code>1 &lt;= n &lt;= 100</code></li>
<li><code>red_edges.length &lt;= 400</code></li>
<li><code>blue_edges.length &lt;= 400</code></li>
<li><code>red_edges[i].length == blue_edges[i].length == 2</code></li>
<li><code>0 &lt;= red_edges[i][j], blue_edges[i][j] &lt; n</code></li>
</ul>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<h6 id="法一"><a class="header-anchor" href="#法一">¶</a>法一</h6>
<p>  难点在于怎么记录访问过的点。记录访问过的节点时要考虑上一条边的颜色，否则会漏掉一些路径。比如，一旦从红边到达过某个结点以后就不能再从红边到达该节点了。如果只记录结点号，而不记录上一条边的颜色，那么如果从红边访问该点后，那么如果能从蓝边访问该点也将被排除，而有的其他结点说不定还真就要通过蓝边经过该点才能访问到。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; shortestAlternatingPaths(<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; red_edges, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; blue_edges) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; r(n), b(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;x : red_edges) r[x[<span class="number">0</span>]].push_back(x[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;x : blue_edges) b[x[<span class="number">0</span>]].push_back(x[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q&#123;&#123;<span class="number">0</span>&#125;&#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans(n, <span class="number">-1</span>), vis(<span class="number">2</span>*n+<span class="number">1</span>);</span><br><span class="line">        ans[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> step = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">            <span class="keyword">int</span> sz = q.size();</span><br><span class="line">            <span class="keyword">while</span>(sz--)&#123;</span><br><span class="line">                <span class="keyword">auto</span> n = q.front(); q.pop();</span><br><span class="line">                <span class="keyword">if</span>(n &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;x : b[n])&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!vis[x*<span class="number">2</span>+<span class="number">1</span>])&#123;</span><br><span class="line">                            vis[x*<span class="number">2</span>+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">if</span>(ans[x] == <span class="number">-1</span>) ans[x] = step+<span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">else</span> ans[x] = min(ans[x], step+<span class="number">1</span>);</span><br><span class="line">                            q.push(-x);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(n &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;x : r[-n])&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!vis[x*<span class="number">2</span>])&#123;</span><br><span class="line">                            vis[x*<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">if</span>(ans[x] == <span class="number">-1</span>) ans[x] = step+<span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">else</span> ans[x] = min(ans[x], step+<span class="number">1</span>);</span><br><span class="line">                            q.push(x);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ++step;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>  同样是bfs的解法，借鉴了dijiskra的思想，用数组保存中间结果。只有遇到更短的路径才会扩展。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; shortestAlternatingPaths(int n, vector&lt;vector&lt;int&gt;&gt;&amp; red_edges, vector&lt;vector&lt;int&gt;&gt;&amp; blue_edges) &#123;</span><br><span class="line">        vector&lt;vector&lt;vector&lt;int&gt;&gt;&gt; G(<span class="number">2</span>, vector&lt;vector&lt;int&gt;&gt;(n));</span><br><span class="line">        <span class="keyword">for</span>(auto &amp;x : red_edges) G[<span class="number">0</span>][x[<span class="number">0</span>]].push_back(x[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span>(auto &amp;x : blue_edges) G[<span class="number">1</span>][x[<span class="number">0</span>]].push_back(x[<span class="number">1</span>]);</span><br><span class="line">        vector&lt;vector&lt;int&gt;&gt; res(n, vector&lt;int&gt;(<span class="number">2</span>, INT_MAX));</span><br><span class="line">        res[<span class="number">0</span>][<span class="number">0</span>]=res[<span class="number">0</span>][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        queue&lt;pair&lt;int,int&gt;&gt; q; q.push(&#123;<span class="number">0</span>,<span class="number">0</span>&#125;); q.push(&#123;<span class="number">0</span>,<span class="number">1</span>&#125;);</span><br><span class="line">        vector&lt;int&gt; ans(n);</span><br><span class="line">        <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">            int sz= q.size();</span><br><span class="line">            <span class="keyword">while</span>(sz--)&#123;</span><br><span class="line">                auto [n, c] = q.front(); q.pop();</span><br><span class="line">                <span class="keyword">for</span>(auto &amp;x : G[<span class="number">1</span>-c][n])&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="number">1</span>+res[n][c] &lt; res[x][<span class="number">1</span>-c]) &#123;</span><br><span class="line">                        res[x][<span class="number">1</span>-c] = <span class="number">1</span> + res[n][c];</span><br><span class="line">                        q.push(&#123;x, <span class="number">1</span>-c&#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(int i = <span class="number">0</span>;i &lt; n; ++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(res[i][<span class="number">0</span>] == res[i][<span class="number">1</span>] &amp;&amp; res[i][<span class="number">0</span>] == INT_MAX) ans[i] = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">else</span> ans[i] = min(res[i][<span class="number">0</span>], res[i][<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="法二"><a class="header-anchor" href="#法二">¶</a>法二</h6>
<p>  leetcode-cn.com题解区的思路比较清晰的题解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">shortestAlternatingPaths</span><span class="params">(self, n: int, red_edges: List[List[int]], blue_edges: List[List[int]])</span> -&gt; List[int]:</span></span><br><span class="line">        red_path = [set() <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">        blue_path = [set() <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">        dist = [[<span class="literal">None</span>, <span class="literal">None</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">        dist[<span class="number">0</span>] = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">        step = <span class="number">0</span></span><br><span class="line">        now_red = [<span class="number">0</span>]</span><br><span class="line">        now_blue = [<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> start, end <span class="keyword">in</span> red_edges:</span><br><span class="line">            red_path[start].add(end)</span><br><span class="line">        <span class="keyword">for</span> start, end <span class="keyword">in</span> blue_edges:</span><br><span class="line">            blue_path[start].add(end)</span><br><span class="line">        <span class="comment"># step 1 找到分别以红边开始和以蓝边开始的两条最短路径</span></span><br><span class="line">        <span class="keyword">while</span> len(now_red) != <span class="number">0</span> <span class="keyword">or</span> len(now_blue) != <span class="number">0</span> :</span><br><span class="line">            new_red, new_blue = [], []</span><br><span class="line">            step += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> len(now_blue) != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">for</span> point <span class="keyword">in</span> now_blue:</span><br><span class="line">                    <span class="keyword">for</span> next_point <span class="keyword">in</span> red_path[point]:</span><br><span class="line">                        <span class="keyword">if</span> dist[next_point][<span class="number">0</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                            new_red.append(next_point)</span><br><span class="line">                            dist[next_point][<span class="number">0</span>] = step</span><br><span class="line">            <span class="keyword">if</span> len(now_red) != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">for</span> point <span class="keyword">in</span> now_red:</span><br><span class="line">                    <span class="keyword">for</span> next_point <span class="keyword">in</span> blue_path[point]:</span><br><span class="line">                        <span class="keyword">if</span> dist[next_point][<span class="number">1</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                            new_blue.append(next_point)</span><br><span class="line">                            dist[next_point][<span class="number">1</span>] = step</span><br><span class="line">            now_red, now_blue = new_red, new_blue</span><br><span class="line">        <span class="comment"># step 2 在这两条最短路径中选择小的，merge成我们的答案</span></span><br><span class="line">        ans = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> dist[i][<span class="number">0</span>] <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> dist[i][<span class="number">1</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                ans.append(<span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">elif</span> dist[i][<span class="number">0</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> dist[i][<span class="number">1</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                ans.append(min(dist[i][<span class="number">0</span>], dist[i][<span class="number">1</span>]))</span><br><span class="line">            <span class="keyword">elif</span> dist[i][<span class="number">0</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                ans.append(dist[i][<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ans.append(dist[i][<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">//作者：coldme<span class="number">-2</span></span><br><span class="line">//链接：https://leetcode-cn.com/problems/shortest-path-<span class="keyword">with</span>-alternating-colors/solution/tu-jie-hong-lan-liang-lu-jiao-cha-bfs-by-coldme<span class="number">-2</span>/</span><br><span class="line">//来源：力扣（LeetCode）</span><br><span class="line">//著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span><br></pre></td></tr></table></figure>
<h6 id="法三-dfs"><a class="header-anchor" href="#法三-dfs">¶</a>法三 dfs</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e8</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; &gt;&amp; g, <span class="keyword">int</span> col, <span class="keyword">int</span> i, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt;&amp; res)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> j : g[col][i]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res[i][col] + <span class="number">1</span> &lt; res[j][!col]) &#123;</span><br><span class="line">                res[j][!col] = res[i][col] + <span class="number">1</span>;</span><br><span class="line">                dfs(g, !col, j, res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; shortestAlternatingPaths(<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; red_edges, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; blue_edges) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; rg(n);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; bg(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; e : red_edges) rg[e[<span class="number">0</span>]].push_back(e[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; e : blue_edges) bg[e[<span class="number">0</span>]].push_back(e[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; &gt; g&#123;rg, bg&#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; res(n, &#123;INF, INF&#125;);</span><br><span class="line">        res[<span class="number">0</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        dfs(g, <span class="number">0</span>, <span class="number">0</span>, res);</span><br><span class="line">        dfs(g, <span class="number">1</span>, <span class="number">0</span>, res);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; out(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            out[i] = min(res[i][<span class="number">0</span>], res[i][<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (out[i] == INF) out[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//作者：da-li-wang</span></span><br><span class="line"><span class="comment">//链接：https://leetcode-cn.com/problems/shortest-path-with-alternating-colors/solution/c-shen-du-you-xian-sou-suo-by-da-li-wang-4/</span></span><br><span class="line"><span class="comment">//来源：力扣（LeetCode）</span></span><br><span class="line"><span class="comment">//著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/13/765-Couples-Holding-Hands/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/13/765-Couples-Holding-Hands/" itemprop="url">765. Couples Holding Hands</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-13T21:25:21+08:00">2020-02-13</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-14T00:24:52+08:00">2020-02-14</time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="765-couples-holding-hands"><a class="header-anchor" href="#765-couples-holding-hands">¶</a><a href="https://leetcode.com/problems/couples-holding-hands/" target="_blank" rel="noopener">765. Couples Holding Hands</a></h3>
<p>Difficulty: <strong>Hard</strong></p>
<p>N couples sit in 2N seats arranged in a row and want to hold hands. We want to know the minimum number of swaps so that every couple is sitting side by side. A <em>swap</em> consists of choosing <strong>any</strong> two people, then they stand up and switch seats.</p>
<p>The people and seats are represented by an integer from <code>0</code> to <code>2N-1</code>, the couples are numbered in order, the first couple being <code>(0, 1)</code>, the second couple being <code>(2, 3)</code>, and so on with the last couple being <code>(2N-2, 2N-1)</code>.</p>
<p>The couples’ initial seating is given by <code>row[i]</code> being the value of the person who is initially sitting in the i-th seat.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: row = [0, 2, 1, 3]</span><br><span class="line">Output: 1</span><br><span class="line">Explanation: We only need to swap the second (row[1]) and third (row[2]) person.</span><br></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: row = [3, 2, 0, 1]</span><br><span class="line">Output: 0</span><br><span class="line">Explanation: All couples are already seated side by side.</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong></p>
<ol>
<li><code>len(row)</code> is even and in the range of <code>[4, 60]</code>.</li>
<li><code>row</code> is guaranteed to be a permutation of <code>0...len(row)-1</code>.</li>
</ol>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<h6 id="法一-并查集"><a class="header-anchor" href="#法一-并查集">¶</a>法一 并查集</h6>
<p>  坐错位置的情侣可以构成一个环，比如[5,6,4,0,2,1,9,3,8,7,11,10],可以将这个数组按照情侣组转化为[2,3,2,0,1,0,4,1,4,3,5,5]然后将每个相邻的2i，2i+1位置上的两个数连一条实边代表真实的牵手情况，而真正的情侣之间连一条虚边代表正确的牵手情况（可以看做是在背后牵手），那么可以得到下面几个环：<br>
<code>2-3---3-4---4-1---1-0---0-2</code>(首尾的2连起来刚好是一个环)，<code>5---5-5</code>.将虚边压缩即可得到<code>2-3-4-1-0-2</code>,<code>5-5</code>这样的两个环。注意，像<code>2-3---3-4---4-3</code>这种环是不可能出现的，因为3一共只有两个，所以从某一个人（比如2）出发找环时，环最终肯定会连回到出发的那个人（比如2），而不会连到中间的某个人（比如3）。而对于每个这样的含有K个数的环只需最少K-1次即可复位。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> f[])</span></span>&#123; <span class="keyword">return</span> x == f[x] ? x: f[x] = find(f[x], f); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minSwapsCouples</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; row)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = row.size();</span><br><span class="line">        <span class="keyword">int</span> f[N/<span class="number">2</span>]&#123;&#125;, ans = <span class="number">0</span>;</span><br><span class="line">        iota(f, f+N/<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i+=<span class="number">2</span>) f[find(f[row[i]/<span class="number">2</span>], f)] = find(row[i+<span class="number">1</span>]/<span class="number">2</span>, f);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N/<span class="number">2</span>; ++i) <span class="keyword">if</span>(f[i] == i) ans++;</span><br><span class="line">        <span class="keyword">return</span> N/<span class="number">2</span>-ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//0 3 5 7 6 8 1 2 4 9</span></span><br></pre></td></tr></table></figure>
<h6 id="法二-贪心-hash"><a class="header-anchor" href="#法二-贪心-hash">¶</a>法二 贪心+hash</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minSwapsCouples</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; row)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = row.size(), ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> idx[N]&#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) idx[row[i]] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N/<span class="number">2</span>; ++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(row[<span class="number">2</span>*i+<span class="number">1</span>] != (row[<span class="number">2</span>*i]^<span class="number">1</span>))&#123;</span><br><span class="line">                ++ans;</span><br><span class="line">                <span class="keyword">int</span> j = idx[row[<span class="number">2</span>*i]^<span class="number">1</span>];</span><br><span class="line">                swap(row[<span class="number">2</span>*i+<span class="number">1</span>], row[j]);</span><br><span class="line">                idx[row[j]]=j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="法三-求连通分量"><a class="header-anchor" href="#法三-求连通分量">¶</a>法三 求连通分量</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minSwapsCouples</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; row)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = row.size()/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> couples[N][<span class="number">2</span>]&#123;&#125;, adj[N+<span class="number">1</span>][<span class="number">2</span>]&#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N*<span class="number">2</span>; ++i) add(couples[row[i]/<span class="number">2</span>], i/<span class="number">2</span>+<span class="number">1</span>); </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) add(adj[couples[i][<span class="number">0</span>]], couples[i][<span class="number">1</span>]),add(adj[couples[i][<span class="number">1</span>]], couples[i][<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">int</span> ans = N;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(adj[i][<span class="number">0</span>] == <span class="number">0</span> &amp;&amp; adj[i][<span class="number">1</span>] == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            ans--;</span><br><span class="line">            <span class="keyword">int</span> x = i, y = pop(adj[i]);</span><br><span class="line">            <span class="keyword">while</span>(y != i)&#123;</span><br><span class="line">                remove(adj[y], x);</span><br><span class="line">                x = y;</span><br><span class="line">                y = pop(adj[x]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a[], <span class="keyword">int</span> x)</span></span>&#123; a[a[<span class="number">0</span>]==<span class="number">0</span>?<span class="number">0</span>:<span class="number">1</span>] =x;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> a[], <span class="keyword">int</span> x)</span></span>&#123; a[a[<span class="number">0</span>]==x?<span class="number">0</span>:<span class="number">1</span>] = <span class="number">0</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pop</span><span class="params">(<span class="keyword">int</span> a[])</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">if</span>(a[<span class="number">0</span>]!=<span class="number">0</span>)&#123; x = a[<span class="number">0</span>]; a[<span class="number">0</span>] = <span class="number">0</span>;&#125;</span><br><span class="line">        <span class="keyword">else</span>&#123; x = a[<span class="number">1</span>]; a[<span class="number">1</span>] = <span class="number">0</span>;&#125;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/12/818-Race-Car/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/12/818-Race-Car/" itemprop="url">818. Race Car</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-12T23:16:00+08:00">2020-02-12</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-13T12:00:37+08:00">2020-02-13</time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="818-race-car"><a class="header-anchor" href="#818-race-car">¶</a><a href="https://leetcode.com/problems/race-car/" target="_blank" rel="noopener">818. Race Car</a></h3>
<p>Difficulty: <strong>Hard</strong></p>
<p>Your car starts at position 0 and speed +1 on an infinite number line.  (Your car can go into negative positions.)</p>
<p>Your car drives automatically according to a sequence of instructions A (accelerate) and R (reverse).</p>
<p>When you get an instruction “A”, your car does the following: <code>position += speed, speed *= 2</code>.</p>
<p>When you get an instruction “R”, your car does the following: if your speed is positive then <code>speed = -1</code> , otherwise <code>speed = 1</code>.  (Your position stays the same.)</p>
<p>For example, after commands “AAR”, your car goes to positions 0-&gt;1-&gt;3-&gt;3, and your speed goes to 1-&gt;2-&gt;4-&gt;-1.</p>
<p>Now for some target position, say the <strong>length</strong> of the shortest sequence of instructions to get there.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Example 1:</span><br><span class="line">Input: </span><br><span class="line">target = 3</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: </span><br><span class="line">The shortest instruction sequence is &quot;AA&quot;.</span><br><span class="line">Your position goes from 0-&gt;1-&gt;3.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Example 2:</span><br><span class="line">Input: </span><br><span class="line">target = 6</span><br><span class="line">Output: 5</span><br><span class="line">Explanation: </span><br><span class="line">The shortest instruction sequence is &quot;AAARA&quot;.</span><br><span class="line">Your position goes from 0-&gt;1-&gt;3-&gt;7-&gt;7-&gt;6.</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong></p>
<ul>
<li><code>1 &lt;= target &lt;= 10000</code>.</li>
</ul>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<p>强烈推荐阅读<a href="https://leetcode.com/problems/race-car/solution/" target="_blank" rel="noopener">官方题解</a>!!!里面关于正确性的证明很清晰，关于为何开始不能转向的证明也很妙。大致思路是将整个过程看做不断往前-&gt;转向-&gt;不断往前-&gt;转向-&gt;…的一个序列，用题目的表示法即<code>A^k1 R A^k2 R A^k3 R A^k4 R...</code>(<code>A^k1</code>代表连续的<code>k1</code>个<code>A</code>)。</p>
<h6 id="法一-dp-top-down"><a class="header-anchor" href="#法一-dp-top-down">¶</a>法一 dp top-down</h6>
<p>  两种情况：1. 刚好超过target，则反向，此时获得一个子问题；2.刚好未到target，反向折回一段，然后再反向，此处又获得一个子问题；(注意子问题是速度为1时到达当前方向上距离当前点距离为target的点需要的最少步数)。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">racecar</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> lg[target+<span class="number">2</span>] &#123;&#125;, m[target+<span class="number">1</span>] &#123;&#125;;<span class="comment">//lg数组的大小一定要比target+1还大1，因为int n = lg[t + 1];当t为target，t+1为target+1。</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; target+<span class="number">2</span>; ++i) lg[i] = lg[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> dp(target, lg, m);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dp</span><span class="params">(<span class="keyword">int</span> t, <span class="keyword">int</span> lg[], <span class="keyword">int</span> m[])</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(m[t] != <span class="number">0</span>) <span class="keyword">return</span> m[t];</span><br><span class="line">        <span class="keyword">int</span> n = lg[t + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span> &lt;&lt; n == t + <span class="number">1</span>) <span class="keyword">return</span> m[t] = n; </span><br><span class="line">        m[t] = n + <span class="number">2</span> + dp((<span class="number">1</span>&lt;&lt;n+<span class="number">1</span>)<span class="number">-1</span>-t, lg, m);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) m[t] = min(m[t], n+i+<span class="number">2</span>+dp(t-(<span class="number">1</span>&lt;&lt;n)+(<span class="number">1</span>&lt;&lt;i), lg, m));</span><br><span class="line">        <span class="keyword">return</span> m[t];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>不用log数组:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> dp[<span class="number">10001</span>];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">racecar</span><span class="params">(<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dp[t] &gt; <span class="number">0</span>) <span class="keyword">return</span> dp[t];</span><br><span class="line">        <span class="keyword">int</span> n = log2(t) + <span class="number">1</span>, res;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; n == t + <span class="number">1</span>) dp[t] = n;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// n steps with 1 return</span></span><br><span class="line">            dp[t] = racecar((<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span> - t) + n + <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// n-1 steps with m steps with 2 returns</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">0</span>; m &lt; n - <span class="number">1</span>; ++m)</span><br><span class="line">                dp[t] = min(dp[t], racecar(t - (<span class="number">1</span> &lt;&lt; (n - <span class="number">1</span>)) + (<span class="number">1</span> &lt;&lt; m)) + n + m + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[t];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="法二-dp-bottom-up"><a class="header-anchor" href="#法二-dp-bottom-up">¶</a>法二 dp bottom-up</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">racecar</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[target + <span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= target; i++) &#123;</span><br><span class="line">        dp[i] = Integer.MAX_VALUE;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">1</span>, j = <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (; j &lt; i; j = (<span class="number">1</span> &lt;&lt; ++m) - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> q = <span class="number">0</span>, p = <span class="number">0</span>; p &lt; j; p = (<span class="number">1</span> &lt;&lt; ++q) - <span class="number">1</span>) &#123;</span><br><span class="line">                dp[i] = Math.min(dp[i], m + <span class="number">1</span> + q + <span class="number">1</span> + dp[i - (j - p)]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        dp[i] = Math.min(dp[i], m + (i == j ? <span class="number">0</span> : <span class="number">1</span> + dp[j - i]));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[target];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="法三-bfs"><a class="header-anchor" href="#法三-bfs">¶</a>法三 bfs</h6>
<p>  bfs方法效率的关键在于unordered_set里hash函数怎么写。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">hash</span> &#123;</span> <span class="keyword">size_t</span> <span class="keyword">operator</span>()( <span class="keyword">const</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&amp; x ) <span class="keyword">const</span> &#123;  <span class="keyword">return</span> <span class="keyword">size_t</span>( x.first ) * <span class="keyword">size_t</span>( <span class="number">1e5</span>+<span class="number">1</span> ) + <span class="keyword">size_t</span>( x.second );  &#125; &#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">racecar</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vc(target+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">unordered_set</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;,hash&gt; st;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">queue</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; qc,qc2;</span><br><span class="line">        <span class="keyword">int</span> mv=<span class="number">0</span>;</span><br><span class="line">        qc.push(make_pair(<span class="number">0</span>,<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span>(!target) <span class="keyword">return</span> mv;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mv++;</span><br><span class="line">            <span class="keyword">while</span>(!qc.empty())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">auto</span> t1=qc.front();</span><br><span class="line">                qc.pop();</span><br><span class="line">                <span class="keyword">int</span> pos = t1.first+t1.second;</span><br><span class="line">                <span class="keyword">int</span> vel=t1.second*<span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span>(pos==target)</span><br><span class="line">                    <span class="keyword">return</span> mv;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">abs</span>(pos-target)&lt;=target&amp;&amp;st.insert(pair(pos,vel)).second)</span><br><span class="line">                &#123;</span><br><span class="line">                    qc2.push(pair(pos,vel));</span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">if</span>(t1.second&lt;<span class="number">0</span>) vel =<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> vel=<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">if</span>(st.insert(pair(t1.first,vel)).second)</span><br><span class="line">                &#123;</span><br><span class="line">                    qc2.push(pair(t1.first,vel));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            swap(qc,qc2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>tuple版:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">hash</span>&#123;</span> <span class="keyword">size_t</span> <span class="keyword">operator</span> ()(<span class="keyword">const</span> tuple&lt;<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &amp;t) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">size_t</span>(get&lt;<span class="number">0</span>&gt;(t))&lt;&lt;<span class="number">18</span>|<span class="keyword">size_t</span>(get&lt;<span class="number">1</span>&gt;(t))&lt;&lt;<span class="number">5</span>|((<span class="keyword">size_t</span>(get&lt;<span class="number">2</span>&gt;(t))+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">    &#125;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">racecar</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;tuple&lt;<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; q, q1;</span><br><span class="line">        q.push(&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;);</span><br><span class="line">        <span class="built_in">unordered_set</span>&lt;tuple&lt;<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>&gt;, hash&gt; s;</span><br><span class="line">        s.insert(&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;);</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">            <span class="keyword">int</span> sz =q.size();</span><br><span class="line">            <span class="keyword">while</span>(sz--)&#123;</span><br><span class="line">                <span class="keyword">auto</span> [pos, speed, dir] = q.front(); q.pop();</span><br><span class="line">                <span class="keyword">if</span>(pos == target) <span class="keyword">return</span> ans;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">abs</span>(pos+(<span class="number">1</span>&lt;&lt;speed)*dir-target) &lt;= target &amp;&amp; s.insert(&#123;pos+(<span class="number">1</span>&lt;&lt;speed)*dir, speed+<span class="number">1</span>, dir&#125;).second)&#123;</span><br><span class="line">                    q1.push(&#123;pos+(<span class="number">1</span>&lt;&lt;speed)*dir, speed+<span class="number">1</span>, dir&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(s.insert(&#123;pos,<span class="number">0</span>,-dir&#125;).second)&#123;</span><br><span class="line">                    q1.push(&#123;pos,<span class="number">0</span>,-dir&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(q, q1);</span><br><span class="line">            ++ans;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="法四-dijiskra"><a class="header-anchor" href="#法四-dijiskra">¶</a>法四 dijiskra</h6>
<p>  在某个位置转向后重新出发看做一个该位置对应的结点，以到终点的距离和正负代表结点的位置和方向。比如target即代表起点正向，而-target代表起点反向，特殊地，-3代表反向且位置位于target-3处。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">racecar</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> K = <span class="number">33</span>-__builtin_clz(target<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">int</span> thr = <span class="number">1</span>&lt;&lt;K;</span><br><span class="line">        <span class="keyword">int</span> dis[thr*<span class="number">2</span>+<span class="number">1</span>];</span><br><span class="line">        fill(dis, dis+thr*<span class="number">2</span>+<span class="number">1</span>, INT_MAX);</span><br><span class="line">        </span><br><span class="line">        priority_queue&lt;Node&gt; q;</span><br><span class="line">        q.push(&#123;<span class="number">0</span>,target&#125;);</span><br><span class="line">        dis[target] = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">            <span class="keyword">auto</span> n = q.top(); q.pop();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(dis[thr+n.pos] &lt; n.steps) <span class="keyword">continue</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(n.pos == <span class="number">0</span>) <span class="keyword">return</span> n.steps;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= K; ++i)&#123;</span><br><span class="line">                <span class="keyword">int</span> npos = (<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>-n.pos;</span><br><span class="line">                <span class="keyword">int</span> nsteps = n.steps + i + (npos == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(npos &gt;= -thr &amp;&amp; npos &lt;= thr &amp;&amp; dis[thr+npos] &gt; nsteps)&#123;</span><br><span class="line">                    q.push(&#123;nsteps, npos&#125;);</span><br><span class="line">                    dis[thr+npos] = nsteps;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> steps, pos;</span><br><span class="line">        Node(<span class="keyword">int</span> s, <span class="keyword">int</span> p):steps(s), pos(p)&#123;&#125;</span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Node &amp;n) <span class="keyword">const</span> &#123; <span class="keyword">return</span> n.steps &lt; steps; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/12/855-Exam-Room/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/12/855-Exam-Room/" itemprop="url">855. Exam Room</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-12T16:00:58+08:00">2020-02-12</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-12T16:03:21+08:00">2020-02-12</time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="855-exam-room"><a class="header-anchor" href="#855-exam-room">¶</a><a href="https://leetcode.com/problems/exam-room/" target="_blank" rel="noopener">855. Exam Room</a></h3>
<p>Difficulty: <strong>Medium</strong></p>
<p>In an exam room, there are <code>N</code> seats in a single row, numbered <code>0, 1, 2, ..., N-1</code>.</p>
<p>When a student enters the room, they must sit in the seat that maximizes the distance to the closest person.  If there are multiple such seats, they sit in the seat with the lowest number.  (Also, if no one is in the room, then the student sits at seat number 0.)</p>
<p>Return a class <code>ExamRoom(int N)</code> that exposes two functions: <code>ExamRoom.seat()</code> returning an <code>int</code> representing what seat the student sat in, and <code>ExamRoom.leave(int p)</code> representing that the student in seat number <code>p</code> now leaves the room.  It is guaranteed that any calls to <code>ExamRoom.leave(p)</code> have a student sitting in seat <code>p</code>.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: [&quot;ExamRoom&quot;,&quot;seat&quot;,&quot;seat&quot;,&quot;seat&quot;,&quot;seat&quot;,&quot;leave&quot;,&quot;seat&quot;], [[10],[],[],[],[],[4],[]]</span><br><span class="line">Output: [null,0,9,4,2,null,5]</span><br><span class="line">Explanation:</span><br><span class="line">ExamRoom(10) -&gt; null</span><br><span class="line">seat() -&gt; 0, no one is in the room, then the student sits at seat number 0.</span><br><span class="line">seat() -&gt; 9, the student sits at the last seat number 9.</span><br><span class="line">seat() -&gt; 4, the student sits at the last seat number 4.</span><br><span class="line">seat() -&gt; 2, the student sits at the last seat number 2.</span><br><span class="line">leave(4) -&gt; null</span><br><span class="line">seat() -&gt; 5, the student sits at the last seat number 5.</span><br></pre></td></tr></table></figure>
<p>​​​​​​​</p>
<p><strong>Note:</strong></p>
<ol>
<li><code>1 &lt;= N &lt;= 10^9</code></li>
<li><code>ExamRoom.seat()</code> and <code>ExamRoom.leave()</code> will be called at most <code>10^4</code> times across all test cases.</li>
<li>Calls to <code>ExamRoom.leave(p)</code> are guaranteed to have a student currently sitting in seat number <code>p</code>.</li>
</ol>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<h6 id="法一-set-线性扫描"><a class="header-anchor" href="#法一-set-线性扫描">¶</a>法一 set 线性扫描</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExamRoom</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; students;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    ExamRoom(<span class="keyword">int</span> N) &#123;</span><br><span class="line">        n = N;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">seat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pos = <span class="number">0</span>, space = <span class="number">0</span>, last;</span><br><span class="line">        <span class="keyword">if</span> (students.empty()) &#123;</span><br><span class="line">            students.insert(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            last = -*students.begin();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> cur: students) &#123;</span><br><span class="line">                <span class="keyword">int</span> mid = (cur+last)/<span class="number">2</span>;</span><br><span class="line">                <span class="comment">//cout &lt;&lt; last &lt;&lt; cur &lt;&lt; mid &lt;&lt; endl;</span></span><br><span class="line">                <span class="keyword">if</span> (mid-last &gt; space) &#123;</span><br><span class="line">                    pos = mid;</span><br><span class="line">                    space = mid-last;</span><br><span class="line">                &#125;</span><br><span class="line">                last = cur;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (n<span class="number">-1</span>-last &gt; space) pos = n<span class="number">-1</span>;</span><br><span class="line">            students.insert(pos);</span><br><span class="line">            <span class="keyword">return</span> pos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">leave</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        students.erase(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="法二-自定义区间类"><a class="header-anchor" href="#法二-自定义区间类">¶</a>法二 自定义区间类</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExamRoom</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Inteval</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> start;</span><br><span class="line">        <span class="keyword">int</span> end;</span><br><span class="line">        <span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line">        Inteval(<span class="keyword">int</span> start_, <span class="keyword">int</span> end_, <span class="keyword">int</span> N_):</span><br><span class="line">            start(start_),end(end_),N(N_)&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (Inteval <span class="keyword">const</span> &amp; other) <span class="keyword">const</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> dist1 = <span class="number">0</span>, dist2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (start == <span class="number">0</span> || end == N - <span class="number">1</span>)</span><br><span class="line">                dist1 = end - start + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                dist1= (end - start) / <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (other.start == <span class="number">0</span> || other.end == N - <span class="number">1</span>)</span><br><span class="line">                dist2 = other.end - other.start + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                dist2= (other.end - other.start) / <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> dist1 == dist2 ? start &lt; other.start : dist1 &gt; dist2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">set</span>&lt;Inteval&gt; seats;</span><br><span class="line">    <span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line">    ExamRoom(<span class="keyword">int</span> N_):</span><br><span class="line">        N(N_) </span><br><span class="line">    &#123;</span><br><span class="line">        seats.emplace(<span class="number">0</span>, N_ - <span class="number">1</span>, N_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">seat</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!seats.empty()) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// showSeats();</span></span><br><span class="line">            <span class="keyword">auto</span> remain = *seats.begin();</span><br><span class="line">            seats.erase(seats.begin());</span><br><span class="line">            <span class="keyword">if</span> (remain.start == <span class="number">0</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                remain.start = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (remain.end &gt;= remain.start) seats.insert(remain);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (remain.end == N - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                remain.end = N - <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (remain.end &gt;= remain.start) seats.insert(remain);</span><br><span class="line">                <span class="keyword">return</span> N - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> mid = (remain.start + remain.end) / <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (mid - <span class="number">1</span> &gt;= remain.start)  seats.emplace(remain.start, mid - <span class="number">1</span>, N);</span><br><span class="line">                <span class="keyword">if</span> (mid + <span class="number">1</span> &lt;= remain.end) seats.emplace(mid + <span class="number">1</span>, remain.end, N);</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">leave</span><span class="params">(<span class="keyword">int</span> p)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> new_start = INT_MIN;</span><br><span class="line">        <span class="keyword">int</span> new_end = INT_MAX;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Inteval&gt; to_delete;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;entry : seats) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.end == p - <span class="number">1</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                new_start = entry.start;</span><br><span class="line">                to_delete.push_back(entry);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (entry.start == p + <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                new_end = entry.end;</span><br><span class="line">                to_delete.push_back(entry);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> elem : to_delete)  seats.erase(elem);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (new_start == INT_MIN) new_start = p;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (new_end == INT_MAX)  new_end = p;</span><br><span class="line"></span><br><span class="line">        seats.emplace(new_start, new_end, N);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/11/798-Smallest-Rotation-with-Highest-Score/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/11/798-Smallest-Rotation-with-Highest-Score/" itemprop="url">798. Smallest Rotation with Highest Score</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-11T18:28:00+08:00">2020-02-11</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-11T21:51:15+08:00">2020-02-11</time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="798-smallest-rotation-with-highest-score"><a class="header-anchor" href="#798-smallest-rotation-with-highest-score">¶</a><a href="https://leetcode.com/problems/smallest-rotation-with-highest-score/" target="_blank" rel="noopener">798. Smallest Rotation with Highest Score</a></h3>
<p>Difficulty: <strong>Hard</strong></p>
<p>Given an array <code>A</code>, we may rotate it by a non-negative integer <code>K</code> so that the array becomes <code>A[K], A[K+1], A{K+2], ... A[A.length - 1], A[0], A[1], ..., A[K-1]</code>.  Afterward, any entries that are less than or equal to their index are worth 1 point.</p>
<p>For example, if we have <code>[2, 4, 1, 3, 0]</code>, and we rotate by <code>K = 2</code>, it becomes <code>[1, 3, 0, 2, 4]</code>.  This is worth 3 points because 1 &gt; 0 [no points], 3 &gt; 1 [no points], 0 &lt;= 2 [one point], 2 &lt;= 3 [one point], 4 &lt;= 4 [one point].</p>
<p>Over all possible rotations, return the rotation index K that corresponds to the highest score we could receive.  If there are multiple answers, return the smallest such index K.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Example 1:</span><br><span class="line">Input: [2, 3, 1, 4, 0]</span><br><span class="line">Output: 3</span><br><span class="line">Explanation:  </span><br><span class="line">Scores for each K are listed below: </span><br><span class="line">K = 0,  A = [2,3,1,4,0],    score 2</span><br><span class="line">K = 1,  A = [3,1,4,0,2],    score 3</span><br><span class="line">K = 2,  A = [1,4,0,2,3],    score 3</span><br><span class="line">K = 3,  A = [4,0,2,3,1],    score 4</span><br><span class="line">K = 4,  A = [0,2,3,1,4],    score 3</span><br></pre></td></tr></table></figure>
<p>So we should choose K = 3, which has the highest score.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Example 2:</span><br><span class="line">Input: [1, 3, 0, 2, 4]</span><br><span class="line">Output: 0</span><br><span class="line">Explanation:  A will always have 3 points no matter how it shifts.</span><br><span class="line">So we will choose the smallest K, which is 0.</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong></p>
<ul>
<li><code>A</code> will have length at most <code>20000</code>.</li>
<li><code>A[i]</code> will be in the range <code>[0, A.length]</code>.</li>
</ul>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<h6 id="标准解法"><a class="header-anchor" href="#标准解法">¶</a>标准解法</h6>
<p>我一开始的解法如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">bestRotation</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; A)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = A.size();</span><br><span class="line">        <span class="keyword">int</span> m[n+<span class="number">1</span>]&#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n ; ++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i &lt; A[i]&amp;&amp;A[i] &lt;= n - <span class="number">1</span>)&#123; m[i+<span class="number">1</span>]++; m[n-A[i]+i+<span class="number">1</span>]--; &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(A[i] &lt;= i)&#123; m[<span class="number">0</span>]++; m[i-A[i]+<span class="number">1</span>]--; m[i+<span class="number">1</span>]++; m[n]--; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>, mx = <span class="number">0</span>, ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;</span><br><span class="line">            cnt += m[i];</span><br><span class="line">            <span class="keyword">if</span>(cnt &gt; mx)&#123;  mx = cnt; ans = i; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>  可以发现<code>m[0]++</code>和<code>m[n]--</code>都是可以去掉的，因为n不在0-n-1的范围内，并且起点的变化不影响全局的最大值点的位置。又因为题目规定了数的范围不超过数组长度，所以不用加上<code>A[i] &lt;= n - 1</code>这个判断。这样循环就简化成:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n ; ++i)&#123;</span><br><span class="line">          <span class="keyword">if</span>(i &lt; A[i])&#123; m[i+<span class="number">1</span>]++; m[n-A[i]+i+<span class="number">1</span>]--; &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span>(A[i] &lt;= i)&#123;m[i-A[i]+<span class="number">1</span>]--; m[i+<span class="number">1</span>]++;&#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>  观察上面的循环可以发现<code>m[i+1]++</code>是必定会执行的，即在<code>m[1~n]</code>全部都加上了1，在计算前缀和时这些值的累加会体现为0,1,2,3,…的自然数序列。因此，可以在循环中省略这步，而在计算前缀和时每次多加一个1即可。另外，<code>m[n-A[i]+i+1]--</code>和<code>m[i-A[i]+1]--</code>都可以写成<code>m[(n-A[i]+i+1)%n]--;</code>。综上，可得到下面的超简代码:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">bestRotation</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; A)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = A.size(), change[n]&#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) change[(i - A[i] + <span class="number">1</span> + n) % n] -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) change[i] += change[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> max_element(change, change+n) - change;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="线段树"><a class="header-anchor" href="#线段树">¶</a>线段树</h6>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#define left(i) ((i)*2+1)</span><br><span class="line">#define right(i) ((i)*2+2)</span><br><span class="line"></span><br><span class="line">void update_tree(std::vector&lt;uint16_t&gt; &amp;tree,int index,int first,int last,int start,int end)&#123;</span><br><span class="line">    if(first==start &amp;&amp; last==end)&#123;</span><br><span class="line">        tree[index]++;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        int mid = first + (last - first) / 2;</span><br><span class="line">        if(start&gt;=mid)&#123;</span><br><span class="line">            update_tree(tree,right(index),mid,last,start,end);</span><br><span class="line">        &#125;else if(end&lt;=mid)&#123;</span><br><span class="line">            update_tree(tree,left(index),first,mid,start,end);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            update_tree(tree,left(index),first,mid,start,mid);</span><br><span class="line">            update_tree(tree,right(index),mid,last,mid,end);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void get_res(std::vector&lt;uint16_t&gt; &amp;tree,int &amp;max_score,int &amp;max_index,int index,int first,int last,int count)&#123;</span><br><span class="line">    count += tree[index];</span><br><span class="line">    if(first+1==last)&#123;</span><br><span class="line">        if(count&gt;max_score) &#123;</span><br><span class="line">            max_score = count;</span><br><span class="line">            max_index = first;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        int mid = first + (last - first) / 2;</span><br><span class="line">        get_res(tree,max_score,max_index,left(index),first,mid,count);</span><br><span class="line">        get_res(tree,max_score,max_index,right(index),mid,last,count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    int bestRotation(vector&lt;int&gt;&amp; A) &#123;</span><br><span class="line">        int len = A.size();</span><br><span class="line">        std::vector&lt;uint16_t&gt; tree(A.size()*4,0);</span><br><span class="line">        </span><br><span class="line">        for(int i=0;i&lt;len;i++)&#123;</span><br><span class="line">            int first = i+1;</span><br><span class="line">            int last = len - A[i] + i + 1;  </span><br><span class="line">            </span><br><span class="line">            if(first==len)&#123;</span><br><span class="line">                update_tree(tree,0,0,len,0,last-len);</span><br><span class="line">            &#125;else if(last&gt;len)&#123;</span><br><span class="line">                update_tree(tree,0,0,len,0,last-len);</span><br><span class="line">                update_tree(tree,0,0,len,first,len);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                update_tree(tree,0,0,len,first,last);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        int max_score = 0;         </span><br><span class="line">        int max_index = -1;</span><br><span class="line">        get_res(tree,max_score,max_index,0,0,len,0);</span><br><span class="line">        return max_index;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="优先级队列"><a class="header-anchor" href="#优先级队列">¶</a>优先级队列</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">bestRotation</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; A)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> max_score = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> displacement = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> len = A.size();</span><br><span class="line">        <span class="keyword">int</span> base = <span class="number">0</span>;</span><br><span class="line">        priority_queue&lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;, greater&lt;<span class="keyword">int</span>&gt;&gt; pq;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;A.size(); ++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(A[i]&gt;len) ++base;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(A[i]&gt;i) pq.push(A[i]-i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=len<span class="number">-1</span>, bar=<span class="number">1</span>; i&gt;=<span class="number">0</span>; --i, ++bar)&#123;</span><br><span class="line">            <span class="keyword">while</span>(!pq.empty() &amp;&amp; pq.top()&lt;=bar) &#123;pq.pop();&#125;</span><br><span class="line">            <span class="keyword">if</span>(A[i]&lt;=len &amp;&amp; A[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                pq.push(bar+A[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(len-<span class="keyword">int</span>(pq.size()-base) &gt;= max_score)&#123;</span><br><span class="line">                max_score = len-<span class="keyword">int</span>(pq.size())-base;</span><br><span class="line">                displacement = i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// cout&lt;&lt;"disp: "&lt;&lt;i&lt;&lt;" "&lt;&lt;"score: "&lt;&lt;len-int(pq.size()-base)&lt;&lt;endl;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> displacement;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/11/808-Soup-Servings/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/11/808-Soup-Servings/" itemprop="url">808. Soup Servings</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-11T17:05:38+08:00">2020-02-11</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-11T17:33:57+08:00">2020-02-11</time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="808-soup-servings"><a class="header-anchor" href="#808-soup-servings">¶</a><a href="https://leetcode.com/problems/soup-servings/" target="_blank" rel="noopener">808. Soup Servings</a></h3>
<p>Difficulty: <strong>Medium</strong></p>
<p>There are two types of soup: type A and type B. Initially we have <code>N</code> ml of each type of soup. There are four kinds of operations:</p>
<ol>
<li>Serve 100 ml of soup A and 0 ml of soup B</li>
<li>Serve 75 ml of soup A and 25 ml of soup B</li>
<li>Serve 50 ml of soup A and 50 ml of soup B</li>
<li>Serve 25 ml of soup A and 75 ml of soup B</li>
</ol>
<p>When we serve some soup, we give it to someone and we no longer have it.  Each turn, we will choose from the four operations with equal probability 0.25. If the remaining volume of soup is not enough to complete the operation, we will serve as much as we can.  We stop once we no longer have some quantity of both types of soup.</p>
<p>Note that we do not have the operation where all 100 ml’s of soup B are used first.</p>
<p>Return the probability that soup A will be empty first, plus half the probability that A and B become empty at the same time.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">Input: N = 50</span><br><span class="line">Output: 0.625</span><br><span class="line">Explanation: </span><br><span class="line">If we choose the first two operations, A will become empty first. For the third operation, A and B will become empty at the same time. For the fourth operation, B will become empty first. So the total probability of A becoming empty first plus half the probability that A and B become empty at the same time, is 0.25 * (1 + 1 + 0.5 + 0) = 0.625.</span><br></pre></td></tr></table></figure>
<p><strong>Notes:</strong></p>
<ul>
<li><code>0 &lt;= N &lt;= 10^9</code>.</li>
<li>Answers within <code>10^-6</code> of the true value will be accepted as correct.</li>
</ul>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<h5 id="法一"><a class="header-anchor" href="#法一">¶</a>法一</h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>,<span class="keyword">double</span>&gt;&gt; m;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">dp</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(m.count(a) &amp;&amp; m[a].count(b)) <span class="keyword">return</span> m[a][b];</span><br><span class="line">        <span class="keyword">if</span>(a &lt;= <span class="number">0</span> &amp;&amp; b &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a &lt;= <span class="number">0</span> &amp;&amp; b&gt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a &gt;<span class="number">0</span> &amp;&amp; b &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> m[a][b] = <span class="number">0.25</span>*(dp(a - <span class="number">100</span>, b)+dp(a<span class="number">-75</span>,b<span class="number">-25</span>)+dp(a<span class="number">-50</span>, b<span class="number">-50</span>)+dp(a<span class="number">-25</span>,b<span class="number">-75</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">soupServings</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(N &gt; <span class="number">4000</span>) <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">return</span> dp(N, N);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="法二-比例放缩-减小数据规模"><a class="header-anchor" href="#法二-比例放缩-减小数据规模">¶</a>法二 比例放缩，减小数据规模</h5>
<p>  注意是(N+24)/25，即向上取整。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">double</span> memo[<span class="number">200</span>][<span class="number">200</span>];</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">soupServings</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> N &gt;= <span class="number">4800</span> ?  <span class="number">1.0</span> : f((N + <span class="number">24</span>) / <span class="number">25</span>, (N + <span class="number">24</span>) / <span class="number">25</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a &lt;= <span class="number">0</span> &amp;&amp; b &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">if</span> (a &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (b &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (memo[a][b] &gt; <span class="number">0</span>) <span class="keyword">return</span> memo[a][b];</span><br><span class="line">        memo[a][b] = <span class="number">0.25</span> * (f(a<span class="number">-4</span>,b)+f(a<span class="number">-3</span>,b<span class="number">-1</span>)+f(a<span class="number">-2</span>,b<span class="number">-2</span>)+f(a<span class="number">-1</span>,b<span class="number">-3</span>));</span><br><span class="line">        <span class="keyword">return</span> memo[a][b];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="法三-bottom-up"><a class="header-anchor" href="#法三-bottom-up">¶</a>法三 bottom-up</h5>
<p>c++版</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_NUM 200</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max(m, n) ((m)&gt;(n)?(m):(n))</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">soupServings</span><span class="params">(<span class="keyword">int</span> N)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num = N/<span class="number">25</span>;</span><br><span class="line">    <span class="keyword">if</span> (N%<span class="number">25</span>) num++;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (num &gt;= <span class="number">200</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> dp[MAX_NUM][MAX_NUM] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=num;i++) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">        dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a1,a2,a3,a4;</span><br><span class="line">    <span class="keyword">int</span> b1,b2,b3,b4;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=num;i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=num;j++) &#123;</span><br><span class="line">            a1=max(i<span class="number">-4</span>,<span class="number">0</span>);</span><br><span class="line">            a2=max(i<span class="number">-3</span>,<span class="number">0</span>);</span><br><span class="line">            a3=max(i<span class="number">-2</span>,<span class="number">0</span>);</span><br><span class="line">            a4=max(i<span class="number">-1</span>,<span class="number">0</span>);</span><br><span class="line">            </span><br><span class="line">            b1=j;</span><br><span class="line">            b2=max(j<span class="number">-1</span>,<span class="number">0</span>);</span><br><span class="line">            b3=max(j<span class="number">-2</span>,<span class="number">0</span>);</span><br><span class="line">            b4=max(j<span class="number">-3</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            dp[i][j] = <span class="number">0.25</span>*(dp[a1][b1]+dp[a2][b2]+dp[a3][b3]+dp[a4][b4]);</span><br><span class="line">            <span class="comment">//printf("dp[%d][%d] = %f\n",i,j,dp[i][j]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[num][num];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>java版</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">soupServings</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        N = N/<span class="number">25</span> + (N%<span class="number">25</span> &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (N &gt;= <span class="number">500</span>) <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span>[][] memo = <span class="keyword">new</span> <span class="keyword">double</span>[N+<span class="number">1</span>][N+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">0</span>; s &lt;= <span class="number">2</span>*N; ++s) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">                <span class="keyword">int</span> j = s-i;</span><br><span class="line">                <span class="keyword">if</span> (j &lt; <span class="number">0</span> || j &gt; N) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">double</span> ans = <span class="number">0.0</span>;</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>) ans = <span class="number">1.0</span>;</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; j == <span class="number">0</span>) ans = <span class="number">0.5</span>;</span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    ans = <span class="number">0.25</span> * (memo[M(i-<span class="number">4</span>)][j] + memo[M(i-<span class="number">3</span>)][M(j-<span class="number">1</span>)] +</span><br><span class="line">                                  memo[M(i-<span class="number">2</span>)][M(j-<span class="number">2</span>)] + memo[M(i-<span class="number">1</span>)][M(j-<span class="number">3</span>)]);</span><br><span class="line">                &#125;</span><br><span class="line">                memo[i][j] = ans;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> memo[N][N];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">M</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> Math.max(<span class="number">0</span>, x); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/11/421-Maximum-XOR-of-Two-Numbers-in-an-Array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/11/421-Maximum-XOR-of-Two-Numbers-in-an-Array/" itemprop="url">421. Maximum XOR of Two Numbers in an Array</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-11T16:50:00+08:00">2020-02-11</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-11T17:02:12+08:00">2020-02-11</time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="421-maximum-xor-of-two-numbers-in-an-array"><a class="header-anchor" href="#421-maximum-xor-of-two-numbers-in-an-array">¶</a><a href="https://leetcode.com/problems/maximum-xor-of-two-numbers-in-an-array/" target="_blank" rel="noopener">421. Maximum XOR of Two Numbers in an Array</a></h3>
<p>Difficulty: <strong>Medium</strong></p>
<p>Given a <strong>non-empty</strong> array of numbers, a<sub style="display: inline;">0</sub>, a<sub style="display: inline;">1</sub>, a<sub style="display: inline;">2</sub>, … , a<sub style="display: inline;">n-1</sub>, where 0 ≤ a<sub style="display: inline;">i</sub> &lt; 2<sup>31</sup>.</p>
<p>Find the maximum result of a<sub style="display: inline;">i</sub> XOR a<sub style="display: inline;">j</sub>, where 0 ≤ <em>i</em>, <em>j</em> &lt; <em>n</em>.</p>
<p>Could you do this in O(<em>n</em>) runtime?</p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input: [3, 10, 5, 25, 2, 8]</span><br><span class="line"></span><br><span class="line">Output: 28</span><br><span class="line"></span><br><span class="line">Explanation: The maximum result is 5 ^ 25 = 28.</span><br></pre></td></tr></table></figure>
<h4 id="solution"><a class="header-anchor" href="#solution">¶</a>Solution</h4>
<h6 id="法一-字典树"><a class="header-anchor" href="#法一-字典树">¶</a>法一 字典树</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span>        <span class="comment">// ----------------------------2 使用数组 时间一样，内存小些</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        TrieNode* _children[<span class="number">2</span>];          <span class="comment">// 把left，right换成个数组, 可以省很多事，一是不用再把left和0对应做判断，那么就不用加一个int val字段。</span></span><br><span class="line">        TrieNode() &#123;</span><br><span class="line">            _children[<span class="number">0</span>] = <span class="literal">NULL</span>,_children[<span class="number">1</span>] = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Solution() &#123;</span><br><span class="line">        _root = <span class="keyword">new</span> TrieNode();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        TrieNode *cur = _root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">bool</span> bit = num&gt;&gt;i &amp; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (!cur-&gt;_children[bit]) cur-&gt;_children[bit] = <span class="keyword">new</span> TrieNode();</span><br><span class="line">            cur = cur-&gt;_children[bit];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findMaxXOR_with</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        TrieNode* cur = _root;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">bool</span> bit = num&gt;&gt;i &amp; <span class="number">1</span>;   </span><br><span class="line">            <span class="keyword">if</span> (cur-&gt;_children[!bit]) &#123;     <span class="comment">// 所以可以简化上述为</span></span><br><span class="line">                cur = cur-&gt;_children[!bit];</span><br><span class="line">                res |= (<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> cur = cur-&gt;_children[bit];   <span class="comment">// 不然res第i位为0，不用管</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findMaximumXOR</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num: nums) &#123;</span><br><span class="line">            insert(num);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num: nums) res = <span class="built_in">std</span>::max(res, findMaxXOR_with(num));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    TrieNode* _root;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="二分"><a class="header-anchor" href="#二分">¶</a>二分</h6>
<p>  将数组按某一位是0或者是1分成两组，这样递归求解；</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span>        <span class="comment">// ---------------------- 3 二分的思路，不懂。。</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findMaximumXOR</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.size();</span><br><span class="line">        <span class="keyword">return</span> helper(nums, <span class="number">0</span>, n<span class="number">-1</span>, <span class="number">0</span>, n<span class="number">-1</span>, <span class="number">0</span>, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// (ls, le) and (rs, re) are two ranges of nums, which gives max xor value to current bit;</span></span><br><span class="line">    <span class="comment">// bit decreases from 30 to 0, i.e., working from most significant bit on the left towards right;</span></span><br><span class="line">    <span class="comment">// Similar to quicksort, partition (ls, le) to two ranges (ls, j-1) and (j, le) by swapping elements</span></span><br><span class="line">    <span class="comment">// the range on the left with current bit = 1, and the range on right is 0; We do the same to (rs, re)</span></span><br><span class="line">    <span class="comment">// In order to set the current bit in the answer, i.e. val, to be 1, the left (ls, le) and right (rs,re) ranges must have subranges with opposite bit. If so, val = (val &lt;&lt; 1) + 1; otherwise, val = val &lt;&lt; 1.</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">helper</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> ls, <span class="keyword">int</span> le, <span class="keyword">int</span> rs, <span class="keyword">int</span> re, <span class="keyword">int</span> val, <span class="keyword">int</span> bit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (bit == <span class="number">-1</span>) <span class="keyword">return</span> val;</span><br><span class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;bit, j = ls, k = rs;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = ls; i &lt;= le; i++)  <span class="keyword">if</span> (nums[i]&amp;mask) swap(nums[i], nums[j++]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rs; i &lt;= re; i++)  <span class="keyword">if</span> (nums[i]&amp;mask) swap(nums[i], nums[k++]);</span><br><span class="line">        <span class="comment">// the left range has two subranges, the answer is max of (bit 1 subrange on the left and bit 0 subrange on the right) or (bit 0 subrange on the left and bit 1 subrange on the right)</span></span><br><span class="line">        <span class="keyword">if</span> (j &gt; ls &amp;&amp; j &lt;= le) &#123;</span><br><span class="line">            <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (k &gt; rs) </span><br><span class="line">                ans = helper(nums, j, le, rs, k<span class="number">-1</span>, val*<span class="number">2</span>+<span class="number">1</span>, bit<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">if</span> (k &lt;= re) </span><br><span class="line">                ans = max(ans, helper(nums, ls, j<span class="number">-1</span>, k, re, val*<span class="number">2</span>+<span class="number">1</span>, bit<span class="number">-1</span>));</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// the left range has only bit 0 subrange</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (j &lt;= ls) &#123;</span><br><span class="line">            <span class="comment">// check whether the right range has bit 1 subrange</span></span><br><span class="line">            <span class="keyword">if</span> (k &gt; rs) </span><br><span class="line">                <span class="keyword">return</span> helper(nums, ls, le, rs, k<span class="number">-1</span>, val*<span class="number">2</span>+<span class="number">1</span>, bit<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="keyword">return</span> helper(nums, ls, le, rs, re, val*<span class="number">2</span>, bit<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// the left range has only bit 1 subrange</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// check whether the right range has bit 0 subrange</span></span><br><span class="line">            <span class="keyword">if</span> (k &lt;= re) </span><br><span class="line">                <span class="keyword">return</span> helper(nums, ls, le, k, re, val*<span class="number">2</span>+<span class="number">1</span>, bit<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="keyword">return</span> helper(nums, ls, le, rs, re, val*<span class="number">2</span>, bit<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="法三-二分-stl版"><a class="header-anchor" href="#法三-二分-stl版">¶</a>法三 二分 stl版</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span> orOp = [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123; <span class="keyword">return</span> a | b; &#125;;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span> andOp = [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123; <span class="keyword">return</span> a &amp; b; &#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span>            <span class="comment">// ----------------------------- 4看起来也是二分，更难懂的感觉。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findMaximumXOR</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        mask = accumulate(nums.cbegin(), nums.cend(), <span class="number">0</span>, orOp)</span><br><span class="line">            &amp; ~accumulate(nums.cbegin(), nums.cend(), <span class="number">0x7FFFFFFF</span>, andOp);<span class="comment">//某一位是否既有1又有0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mask == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> msb = computeMsb(mask);</span><br><span class="line">        <span class="keyword">auto</span> msbSplit = msbPartition(nums.begin(), nums.end(), msb);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> findMaximumXor(nums.begin(), msbSplit, msbSplit, nums.end(), msb &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> mask;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> RandomIt&gt;</span><br><span class="line">    <span class="function">RandomIt <span class="title">msbPartition</span><span class="params">(RandomIt beginIt, RandomIt endIt, <span class="keyword">int</span> msb)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> msbSet = [msb](<span class="keyword">int</span> n) &#123; <span class="keyword">return</span> (n &amp; msb) != <span class="number">0</span>; &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">std</span>::partition(beginIt, endIt, msbSet);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">computeMsb</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> msb = n;</span><br><span class="line">        msb |= msb &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        msb |= msb &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        msb |= msb &gt;&gt; <span class="number">4</span>;</span><br><span class="line">        msb |= msb &gt;&gt; <span class="number">8</span>;</span><br><span class="line">        msb |= msb &gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> msb - (msb &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> RandomIt&gt;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findMaximumXor</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        RandomIt beginLeft,</span></span></span><br><span class="line"><span class="function"><span class="params">        RandomIt endLeft,</span></span></span><br><span class="line"><span class="function"><span class="params">        RandomIt beginRight,</span></span></span><br><span class="line"><span class="function"><span class="params">        RandomIt endRight,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> msb</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msb == <span class="number">0</span> || (endLeft - beginLeft == <span class="number">1</span> &amp;&amp; endRight - beginRight == <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span> *beginLeft ^ *beginRight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((mask &amp; msb) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> findMaximumXor(beginLeft, endLeft, beginRight, endRight, msb &gt;&gt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> splitLeft = msbPartition(beginLeft, endLeft, msb);</span><br><span class="line">        <span class="keyword">auto</span> splitRight = msbPartition(beginRight, endRight, msb);</span><br><span class="line">        <span class="keyword">auto</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (splitLeft - beginLeft &gt; <span class="number">0</span> &amp;&amp; endRight - splitRight &gt; <span class="number">0</span>)</span><br><span class="line">            result = findMaximumXor(beginLeft, splitLeft, splitRight, endRight, msb &gt;&gt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (endLeft - splitLeft &gt; <span class="number">0</span> &amp;&amp; splitRight - beginRight &gt; <span class="number">0</span>)</span><br><span class="line">            result = <span class="built_in">std</span>::max(result, findMaximumXor(splitLeft, endLeft, beginRight, splitRight, msb &gt;&gt; <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>) <span class="comment">// no way to set this bit to 1</span></span><br><span class="line">            result = findMaximumXor(beginLeft, endLeft, beginRight, endRight, msb &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/11/AC自动机/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lidanyang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just a blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/11/AC自动机/" itemprop="url">AC自动机</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-11T00:08:00+08:00">2020-02-11</time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-02-11T00:12:47+08:00">2020-02-11</time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/字符串/" itemprop="url" rel="index">
                    <span itemprop="name">字符串</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="ac自动机"><a class="header-anchor" href="#ac自动机">¶</a>AC自动机</h5>
<p>即KMP+Trie</p>
<h5 id="建立带fail指针的字典树的步骤"><a class="header-anchor" href="#建立带fail指针的字典树的步骤">¶</a>建立带fail指针的字典树的步骤</h5>
<ol>
<li>建立字典树</li>
<li>bfs建立fail指针数组</li>
</ol>
<h5 id="代码"><a class="header-anchor" href="#代码">¶</a>代码</h5>
<ol>
<li>数组版</li>
</ol>
<p><a href="https://bestsort.cn/2019/04/28/402/#5d491d7230863b0068662a90" target="_blank" rel="noopener">https://bestsort.cn/2019/04/28/402/#5d491d7230863b0068662a90</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn =  <span class="number">2</span>*<span class="number">1e6</span>+<span class="number">9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> trie[maxn][<span class="number">26</span>]; <span class="comment">//字典树</span></span><br><span class="line"><span class="keyword">int</span> cntword[maxn];  <span class="comment">//记录该单词出现次数</span></span><br><span class="line"><span class="keyword">int</span> fail[maxn];     <span class="comment">//失败时的回溯指针</span></span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertWords</span><span class="params">(<span class="built_in">string</span> s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.size();i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> next = s[i] - <span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!trie[root][next])</span><br><span class="line">            trie[root][next] = ++cnt;</span><br><span class="line">        root = trie[root][next];</span><br><span class="line">    &#125;</span><br><span class="line">    cntword[root]++;      <span class="comment">//当前节点单词数+1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123;      <span class="comment">//将第二层所有出现了的字母扔进队列</span></span><br><span class="line">        <span class="keyword">if</span>(trie[<span class="number">0</span>][i])&#123;</span><br><span class="line">            fail[trie[<span class="number">0</span>][i]] = <span class="number">0</span>;</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fail[now]    -&gt;当前节点now的失败指针指向的地方</span></span><br><span class="line"><span class="comment">////tire[now][i] -&gt; 下一个字母为i+'a'的节点的下标为tire[now][i]</span></span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        <span class="keyword">int</span> now = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123;      <span class="comment">//查询26个字母</span></span><br><span class="line">            <span class="keyword">if</span>(trie[now][i])&#123;</span><br><span class="line">                <span class="comment">//如果有这个子节点为字母i+'a',则</span></span><br><span class="line"><span class="comment">//让这个节点的失败指针指向(((他父亲节点)的失败指针所指向的那个节点)的下一个节点)</span></span><br><span class="line">                <span class="comment">//有点绕,为了方便理解特意加了括号</span></span><br><span class="line"></span><br><span class="line">                fail[trie[now][i]] = trie[fail[now]][i];</span><br><span class="line">                q.push(trie[now][i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span><span class="comment">//否则就让当前节点的这个子节点</span></span><br><span class="line">                <span class="comment">//指向当前节点fail指针的这个子节点</span></span><br><span class="line">                trie[now][i] = trie[fail[now]][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> now = <span class="number">0</span>,ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.size();i++)&#123;    <span class="comment">//遍历文本串</span></span><br><span class="line">        now = trie[now][s[i]-<span class="string">'a'</span>];  <span class="comment">//从s[i]点开始寻找</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=now;j &amp;&amp; cntword[j]!=<span class="number">-1</span>;j=fail[j])&#123;</span><br><span class="line">            <span class="comment">//一直向下寻找,直到匹配失败(失败指针指向根或者当前节点已找过).</span></span><br><span class="line">            ans += cntword[j];</span><br><span class="line">            cntword[j] = <span class="number">-1</span>;    <span class="comment">//将遍历国后的节点标记,防止重复计算</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s ;</span><br><span class="line">        insertWords(s);</span><br><span class="line">    &#125;</span><br><span class="line">    fail[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    getFail();</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; query(s) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>结构体指针版</li>
</ol>
<p><a href="https://leetcode.com/problems/stream-of-characters/" target="_blank" rel="noopener">https://leetcode.com/problems/stream-of-characters/</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamChecker</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Trie</span>&#123;</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;Trie *&gt; nxt;</span><br><span class="line">        Trie *fail;</span><br><span class="line">        <span class="keyword">bool</span> b;</span><br><span class="line">        Trie()&#123; nxt.resize(<span class="number">26</span>); b = <span class="literal">false</span>; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;s)</span></span>&#123;</span><br><span class="line">            <span class="keyword">auto</span> cur = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;c : s)&#123;</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;nxt[c - <span class="string">'a'</span>] == <span class="literal">nullptr</span>) cur-&gt;nxt[c - <span class="string">'a'</span>] = <span class="keyword">new</span> Trie();</span><br><span class="line">                cur = cur-&gt;nxt[c - <span class="string">'a'</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            cur-&gt;b = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Trie *root, *now;</span><br><span class="line">    <span class="comment">// unordered_map&lt;Trie *, Trie *&gt; fail;</span></span><br><span class="line">    StreamChecker(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; words) &#123;</span><br><span class="line">        <span class="comment">//build trie</span></span><br><span class="line">        root = <span class="keyword">new</span> Trie();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;w : words) root-&gt;insert(w);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//init</span></span><br><span class="line">        <span class="built_in">queue</span>&lt;Trie *&gt; q;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;t : root-&gt;nxt) <span class="keyword">if</span>(t) &#123; t-&gt;fail = root; q.push(t); &#125; <span class="keyword">else</span> &#123; t = root; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//BFS get fail pointer</span></span><br><span class="line">        <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">            <span class="keyword">auto</span> node = q.front(); q.pop();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i)&#123;</span><br><span class="line">                <span class="keyword">auto</span> &amp;t = node-&gt;nxt[i];</span><br><span class="line">                <span class="keyword">if</span>(t)&#123; t-&gt;fail = node-&gt;fail-&gt;nxt[i]; q.push(t); &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123; t = node-&gt;fail-&gt;nxt[i]; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        now = root;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">query</span><span class="params">(<span class="keyword">char</span> letter)</span> </span>&#123;</span><br><span class="line">        now = now-&gt;nxt[letter - <span class="string">'a'</span>];</span><br><span class="line">        <span class="keyword">if</span>(now-&gt;b) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">auto</span> cur = now;</span><br><span class="line">        <span class="keyword">while</span>(cur != root)&#123;</span><br><span class="line">            cur = cur-&gt;fail;</span><br><span class="line">            <span class="keyword">if</span>(cur-&gt;b) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">lidanyang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">441</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">115</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/lidanyang" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:1261727840@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lidanyang</span>

  

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.0</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.0"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=6.0.0"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=6.0.0"></script>


  

</body>
</html>
